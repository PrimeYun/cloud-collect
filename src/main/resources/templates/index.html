<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>云收藏</title>
  	<link rel="shortcut icon" href="fav/book.png">
	<link rel=bookmark href="fav/book.png" type=image/x-icon>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-table.js"></script>
	<script src="js/bootstrap-table-zh-CN.js"></script>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-table.css">
</head>
<body>
	
	<button class="btn btn-primary" data-toggle="modal" data-target="#myModal">新增</button>
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h5 class="modal-title" id="myModalLabel">新增</h5>
				</div>
				<div class="modal-body">
					<div class="input-group">
						<span class="input-group-addon">标题</span>
						<input type="text" class="form-control" name="name">
					</div>
					<br>
					<div class="input-group">
						<span class="input-group-addon">链接</span>
						<input type="text" class="form-control" name="url">
					</div>
					<br>
					<div class="input-group">
						<span class="input-group-addon">来源</span>
						<input type="text" class="form-control" name="source">
					</div>
					<br>
					<div class="input-group">
						<span class="input-group-addon">分类</span>
						<input type="text" class="form-control" name="sort">
					</div>
					<br>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="submit()">确定</button>
				</div>
			</div>
		</div>
	</div>
	
    <table id="roleTable" data-mobile-responsive="true" class="mb-bootstrap-table text-nowrap"></table>
  
  
<script>
	var responseHandler = function (e) {
	    if (e.data && e.data.length > 0) {
	        return { "rows": e.data.list, "total": e.data.total };
	    }
	    else {
	        return { "rows": [], "total": 0 };
	    }
	    
	}

	$('#roleTable').bootstrapTable({
	    method: 'get', // 服务器数据的请求方式 get or post
	    url: "/content/list", // 服务器数据的加载地址
	    striped: true, //是否显示行间隔色
	    cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	    pagination: true, //是否显示分页（*）
	    sortable: true, //是否启用排序
	    sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
	    pageNumber: 1, //初始化加载第一页，默认第一页
	    pageSize: 25, //每页的记录行数（*）
	    pageList: [5, 25, 50, 100], //可供选择的每页的行数（*）
	    strictSearch: true,
	    minimumCountColumns: 2, //最少允许的列数
	    clickToSelect: true, //是否启用点击选中行
	    uniqueId: "ID", //每一行的唯一标识，一般为主键列
	    cardView: false,
	    detailView: false, //是否显示详细视图
	    smartDisplay: false,
	    responseHandler: function(res) {
	    	return {
	    		"rows" : res.data.list,
	    		"total" : res.data.total
	    	}
	    },
	    queryParams: function(params) {
	        return {
	            pageSize: params.limit,
	            pageNum: params.offset / params.limit + 1,
	            token:"7b483f20403a4b998b400acac70a480e"
	        };
	    },
	    columns: [{
	        field: 'name',
	        title: '标题'
	    }, {
	        field: 'url',
	        title: '链接地址',
	        formatter: aFormatter
	    }, {
	        field: 'source',
	        title: '来源'
	    }, {
	        field: 'createDate',
	        title: '收藏时间'
	    }, {
	        field: 'sort',
	        title: '分类'
	    }]
	});
	
	function aFormatter(value, row, index) {
			return "<a href='" + value + "' title='单击打开连接' target='_blank'>" + value + "</a>";
	}
	
	function submit() {
		var name = $(":input[name = 'name']").val();
		var url = $(":input[name = 'url']").val();
		var source = $(":input[name = 'source']").val();
		var sort = parseInt($(":input[name = 'sort']").val());
		
		var data = {
				name : name,
				url  : url,
				source:source,
				sort :sort
		};
		
		$.ajax({
			type:'post',
			url : '/content/insert',
			contentType: 'application/json;charset=UTF-8',
			traditional: true,
			data:JSON.stringify(data),
			dataType:'json',
			success:function(data) {
				if (data.code == 200) {
					location.reload();
				} else {
					alert(data.msg);
				}
			}
		})
		
	}

</script>
</body>
</html>